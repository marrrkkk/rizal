<!DOCTYPE html>
<html>
  <head>
    <title>Test Progress API</title>
  </head>
  <body>
    <h1>Test Progress API</h1>
    <div id="results"></div>

    <script>
      async function testAPI() {
        const results = document.getElementById("results");

        // Get token from localStorage (assuming user is logged in)
        const token = localStorage.getItem("token");

        if (!token) {
          results.innerHTML =
            '<p style="color: red;">No token found. Please log in first.</p>';
          return;
        }

        try {
          // Test initialize progress
          console.log("Testing initialize progress...");
          const initResponse = await fetch(
            "http://localhost/rizal/api/progress/initialize_progress.php",
            {
              method: "POST",
              headers: {
                Authorization: `Bearer ${token}`,
                "Content-Type": "application/json",
              },
            }
          );

          const initData = await initResponse.json();
          console.log("Initialize response:", initData);

          // Test get progress
          console.log("Testing get progress...");
          const getResponse = await fetch(
            "http://localhost/rizal/api/progress/get_progress.php",
            {
              method: "GET",
              headers: {
                Authorization: `Bearer ${token}`,
                "Content-Type": "application/json",
              },
            }
          );

          const progressData = await getResponse.json();
          console.log("Progress data:", progressData);

          // Test complete level 1
          console.log("Testing complete level 1...");
          const completeResponse = await fetch(
            "http://localhost/rizal/api/progress/complete_level.php",
            {
              method: "POST",
              headers: {
                Authorization: `Bearer ${token}`,
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                chapter: 1,
                level: 1,
                score: 85,
                timeSpent: 30000,
              }),
            }
          );

          const completeData = await completeResponse.json();
          console.log("Complete level response:", completeData);

          // Test get progress again
          console.log("Testing get progress after completion...");
          const getResponse2 = await fetch(
            "http://localhost/rizal/api/progress/get_progress.php",
            {
              method: "GET",
              headers: {
                Authorization: `Bearer ${token}`,
                "Content-Type": "application/json",
              },
            }
          );

          const progressData2 = await getResponse2.json();
          console.log("Progress data after completion:", progressData2);

          results.innerHTML = `
                    <h2>API Test Results</h2>
                    <h3>Initialize:</h3>
                    <pre>${JSON.stringify(initData, null, 2)}</pre>
                    <h3>Initial Progress:</h3>
                    <pre>${JSON.stringify(progressData, null, 2)}</pre>
                    <h3>Complete Level Response:</h3>
                    <pre>${JSON.stringify(completeData, null, 2)}</pre>
                    <h3>Progress After Completion:</h3>
                    <pre>${JSON.stringify(progressData2, null, 2)}</pre>
                `;
        } catch (error) {
          console.error("API test error:", error);
          results.innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
        }
      }

      // Run test when page loads
      testAPI();
    </script>
  </body>
</html>
